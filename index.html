<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Websocket by laubrence</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Websocket</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/laubrence/websocket" class="btn">View on GitHub</a>
      <a href="https://github.com/laubrence/websocket/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/laubrence/websocket/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h2>
<a id="1-websocket-的背景" class="anchor" href="#1-websocket-%E7%9A%84%E8%83%8C%E6%99%AF" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1. WebSocket 的背景</h2>

<ul>
<li>### Polling
&gt; 采用轮询的方式，浏览器隔个几秒就发送一次请求，询问服务器是否有新信息。
&gt;
&gt;<img src="http://img.blog.csdn.net/20130517151509160" alt="Alt text">
&gt;缺点：需要服务器有很快的处理速度和资源</li>
<li>### Long Polling## 
&gt;采用轮询的方式，客户端发起连接后，如果没消息，就一直不返回Response给客户端。直到有消息才返回，返回完之后，客户端再次建立连接，周而复始。
&gt;
&gt;<img src="http://img.blog.csdn.net/20130517151612871" alt="Alt text">
&gt; 缺点: 需要有很高的并发处理能力</li>
</ul>

<h2>
<a id="2-websocket-是什么" class="anchor" href="#2-websocket-%E6%98%AF%E4%BB%80%E4%B9%88" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2. WebSocket 是什么</h2>

<blockquote>
<p>WebSocket 是 HTML5 一种新的协议。它实现了浏览器与服务器全双工通信，能更好的节省服务器资源和带宽并达到实时通讯。</p>

<ul>
<li>### 基于TCP协议
握手的时序图</li>
</ul>

<p><img src="https://raw.githubusercontent.com/laubrence/static/master/websocket.gif" alt="Alt text"></p>

<ul>
<li>### 双向通信
类似于Socket，服务器和客户端(Browser)都能主动的向对方发送或接收数据</li>
</ul>

<p>传统 HTTP 请求响应客户端服务器交互图 </p>

<p><img src="http://www.ibm.com/developerworks/cn/java/j-lo-WebSocket/img001.jpg" alt="Alt text" title="传统 HTTP 请求响应客户端服务器交互图"></p>

<p>WebSocket 请求响应客户端服务器交互图 </p>

<p><img src="http://www.ibm.com/developerworks/cn/java/j-lo-WebSocket/img002.jpg" alt="Alt text" title="WebSocket 请求响应客户端服务器交互图"></p>
</blockquote>

<h2>
<a id="3-websocket-机制" class="anchor" href="#3-websocket-%E6%9C%BA%E5%88%B6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3. WebSocket 机制</h2>

<ul>
<li>WebSocket 客户端连接报文</li>
</ul>

<pre><code>GET /chat HTTP/1.1
Host: server.example.com
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==
Sec-WebSocket-Protocol: chat, superchat
Sec-WebSocket-Version: 13
Origin: http://example.com
</code></pre>

<ul>
<li>WebSocket 服务端响应报文</li>
</ul>

<pre><code>HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: HSmrc0sMlYUkAGmm5OPpG2HaGWk=
Sec-WebSocket-Protocol: chat
</code></pre>

<ul>
<li>WebSocket API
&gt; 客户端API</li>
</ul>

<pre><code>var ws = new WebSocket(“ws://echo.websocket.org”);
ws.onopen = function(){ws.send(“Test!”); };
ws.onmessage = function(evt){console.log(evt.data);ws.close();};
ws.onclose = function(evt){console.log(“WebSocketClosed!”);};
ws.onerror = function(evt){console.log(“WebSocketError!”);};
</code></pre>

<blockquote>
<p>服务器API</p>

<pre><code> @ServerEndpoint("/echo")
 public class EchoEndpoint {
</code></pre>
</blockquote>

<p><a href="https://github.com/OnOpen" class="user-mention">@OnOpen</a>
 public void onOpen(Session session) throws IOException {
 //以下代码省略...
 }</p>

<p><a href="https://github.com/OnMessage" class="user-mention">@OnMessage</a>
 public String onMessage(String message) {
 //以下代码省略...
 }</p>

<p><a href="https://github.com/Message" class="user-mention">@Message</a>(maxMessageSize=6)
 public void receiveMessage(String s) {
 //以下代码省略...
 } </p>

<p><a href="https://github.com/OnError" class="user-mention">@OnError</a>
 public void onError(Throwable t) {
 //以下代码省略...
 }</p>

<p>@OnClose
 public void onClose(Session session, CloseReason reason) {
 //以下代码省略...
 } 
 }</p>

<pre><code>&gt;Tomcat从7.0.27开始支持 WebSocket，从7.0.47开始支持JSR-356

## 4. WebSocket 应用场景
&gt; 决定手头的工作是否需要使用WebSocket技术的方法很简单：
+ 你的应用提供多个用户相互交流吗？
+ 你的应用是展示服务器端经常变动的数据吗？

&gt; 应用场景
1. WebIM
&gt; 新浪微博 [私信聊天](http://weibo.com/)
2. 在线聊天室 
&gt;[聊天室demo](http://chat.workerman.net/)
3. 多玩家游戏
&gt;[小蝌蚪游戏](http://kedou.workerman.net/)
&gt;
&gt;[BrowserQuest](http://browserquest.mozilla.org/)
4. 视频直播弹幕
&gt;[摄像头录制页面](http://www.workerman.net/demos/live-camera/camera.html)
&gt;
&gt;[实时接收视频流页面](http://www.workerman.net/demos/live-camera/)
5. WEB消息推送
&gt;[推送demo](http://www.workerman.net:2123/)
6. 基于位置的应用
7. 社交订阅
1. 协同编辑
1. ...
</code></pre>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/laubrence/websocket">Websocket</a> is maintained by <a href="https://github.com/laubrence">laubrence</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
