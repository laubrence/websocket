<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>websocket</title>
	<script type="text/javascript" src="src/shCore.js"></script>
	<script type="text/javascript" src="scripts/shBrushJScript.js"></script>
	<link type="text/css" rel="stylesheet" href="styles/shCoreDefault.css"/>
	<script type="text/javascript">SyntaxHighlighter.all();</script>
	<style type="text/css">
		body{background:#FFFF;text-align:center;}
		div{width:778px;margin:0 auto;background:#fff;text-align:left;}
	</style>
	<link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
</head>

<body style="background: white; font-family: Helvetica">
<section class="page-header">
      <h1 class="project-name">WebSocket</h1>
    </section>
<div>

<h2>1. WebSocket 的背景</h2>

<ul><li>Polling</li></ul>

<p>采用轮询的方式，浏览器隔个几秒就发送一次请求，询问服务器是否有新信息。</p>

<p><img alt="Alt text" src="http://img.blog.csdn.net/20130517151509160"/></p>

<p>缺点：需要服务器有很快的处理速度和资源</p>

<ul><li>Long Polling</li></ul>

<p>采用轮询的方式，客户端发起连接后，如果没消息，就一直不返回Response给客户端。直到有消息才返回，返回完之后，客户端再次建立连接，周而复始。</p>

<p><img alt="Alt text" src="http://img.blog.csdn.net/20130517151612871"/></p>

<p>缺点: 需要有很高的并发处理能力</p>

<hr/>

<h2>2. WebSocket 是什么</h2>

<p>WebSocket 是 HTML5 一种新的协议。它实现了浏览器与服务器全双工通信，能更好的节省服务器资源和带宽并达到实时通讯。</p>

<ul><li>基于TCP协议</li></ul>

<p>握手的时序图</p>

<p><img alt="Alt text" src="https://raw.githubusercontent.com/laubrence/static/master/websocket.gif"/></p>

<ul><li>双向通信</li></ul>

<p>类似于Socket，服务器和客户端(Browser)都能主动的向对方发送或接收数据</p>

<p>传统 HTTP 请求响应客户端服务器交互图 </p>

<p><img alt="Alt text" title="传统 HTTP 请求响应客户端服务器交互图" src="http://www.ibm.com/developerworks/cn/java/j-lo-WebSocket/img001.jpg"/></p>

<p>WebSocket 请求响应客户端服务器交互图 </p>

<p><img alt="Alt text" title="WebSocket 请求响应客户端服务器交互图" src="http://www.ibm.com/developerworks/cn/java/j-lo-WebSocket/img002.jpg"/></p>

<hr/>

<h2>3. WebSocket 机制</h2>

<ul><li>WebSocket API</li></ul>

<p>客户端API</p>

<p><code>
<script type="syntaxhighlighter" class="brush: js;">
<![CDATA[
var ws = new WebSocket(“ws://echo.websocket.org”);
ws.onopen = function(){ws.send(“Test!”); };
ws.onmessage = function(evt){console.log(evt.data);ws.close();};
ws.onclose = function(evt){console.log(“WebSocketClosed!”);};
ws.onerror = function(evt){console.log(“WebSocketError!”);};
]]>
</script>

</code></p>

<p>服务器API</p>

<p><code>
<script type="syntaxhighlighter" class="brush: js;">
<![CDATA[
@ServerEndpoint(&quot;/echo&quot;)
public class EchoEndpoint {
 @OnOpen
 public void onOpen(Session session) throws IOException {
 //以下代码省略...
 }
 @OnMessage
 public String onMessage(String message) {
 //以下代码省略...
 }
 @Message(maxMessageSize=6)
 public void receiveMessage(String s) {
 //以下代码省略...
 } 
 @OnError
 public void onError(Throwable t) {
 //以下代码省略...
 }
 @OnClose
 public void onClose(Session session, CloseReason reason) {
 //以下代码省略...
 } 
 }
]]>
</script>

</code></p>

<p>注：Tomcat从7.0.27开始支持 WebSocket，从7.0.47开始支持JSR-356</p>

<ul><li>WebSocket 客户端连接报文</li></ul>

<p><code>
<script type="syntaxhighlighter" class="brush: js;">
<![CDATA[
GET /chat HTTP/1.1
Host: server.example.com
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==
Sec-WebSocket-Protocol: chat, superchat
Sec-WebSocket-Version: 13
Origin: http://example.com
]]>
</script>

</code></p>

<ul><li>WebSocket 服务端响应报文</li></ul>

<p><code>
<script type="syntaxhighlighter" class="brush: js;">
<![CDATA[
HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: HSmrc0sMlYUkAGmm5OPpG2HaGWk=
Sec-WebSocket-Protocol: chat
]]>
</script>

</code></p>

<hr/>

<h2>4. WebSocket 应用场景</h2>

<p>决定手头的工作是否需要使用WebSocket技术的方法很简单：</p>

<ul><li>你的应用提供多个用户相互交流吗？</li><li>你的应用是展示服务器端经常变动的数据吗？</li></ul>

<h3>应用场景</h3>

<ol><li><p>WebIM</p><ul><li><p>WebQQ</p></li><li><p>新浪微博 <a href="http://weibo.com/">私信聊天</a></p></li></ul></li><li><p>在线聊天室 </p><ul><li><p><a href="http://chat.workerman.net/">聊天室demo</a></p></li></ul></li><li><p>多玩家游戏</p><ul><li><p><a href="http://kedou.workerman.net/">小蝌蚪游戏</a></p></li><li><p><a href="http://browserquest.mozilla.org/">BrowserQuest</a></p></li></ul></li><li><p>视频直播弹幕</p><ul><li><p><a href="http://www.workerman.net/demos/live-camera/camera.html">摄像头录制页面</a></p></li><li><p><a href="http://www.workerman.net/demos/live-camera/">实时接收视频流页面</a></p></li></ul></li><li><p>WEB消息推送</p><ul><li><p><a href="http://www.workerman.net:2123/">推送demo</a></p></li></ul></li><li><p>基于位置的应用</p></li><li><p>社交订阅</p></li><li><p>协同编辑</p></li><li><p><a href="http://blog.csdn.net/manyxh/article/details/48196209">IOS CHAT</a></p></li><li><p>...</p></li></ol>

	<hr/>
<h2>5. WebSocket vs 悦跑圈</h2>
	<p>......</p>
	
	<br/>
	<br/>
	<br/>
	<br/>
	<br/>
	<br/>
	<br/>
	<br/>
</div>
</html>
